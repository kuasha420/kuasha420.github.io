<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purrfect Universe | Economic Framework Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a1a;
            color: #e0e0e0;
            overflow-x: hidden;
            position: relative;
        }
        @keyframes move-stars {
            from { background-position: 0 0; }
            to { background-position: -10000px 5000px; }
        }
        .stars {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%; display: block;
            background: transparent url('https://www.transparenttextures.com/patterns/stardust.png') repeat top left;
            animation: move-stars 200s linear infinite; z-index: 0; opacity: 0.5;
        }
        .content-wrapper { position: relative; z-index: 1; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .text-gradient {
            background-image: linear-gradient(to right, #8e44ad, #3498db, #1abc9c);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .card {
            background: rgba(23, 23, 43, 0.5); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease;
        }
        .btn {
            background-color: #8e44ad; color: white; font-weight: 600; padding: 0.75rem 1.5rem;
            border-radius: 9999px; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(142, 68, 173, 0.5); }
        .btn:disabled { background-color: #4a235a; cursor: not-allowed; transform: none; box-shadow: none; }
        .option-btn {
            display: block; width: 100%; text-align: left; padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem;
            background-color: rgba(255, 255, 255, 0.05); transition: all 0.2s ease;
        }
        .option-btn:hover:not(:disabled) { background-color: rgba(142, 68, 173, 0.3); border-color: #8e44ad; }
        .option-btn.correct { background-color: #1abc9c; border-color: #16a085; color: white; font-weight: bold; }
        .option-btn.incorrect { background-color: #e74c3c; border-color: #c0392b; color: white; font-weight: bold; }

        /* Slider styles */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 8px; cursor: pointer; background: #3c1e4a; border-radius: 5px;
        }
        input[type=range]::-webkit-slider-thumb {
            height: 24px; width: 24px; border-radius: 50%; background: #9b59b6;
            cursor: pointer; -webkit-appearance: none; margin-top: -8px;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.7);
        }
    </style>
</head>
<body class="bg-[#0a0a1a]">
    <div class="stars"></div>
    <div class="content-wrapper min-h-screen flex flex-col items-center justify-center p-4">

        <div id="quiz-container" class="w-full max-w-3xl">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="font-orbitron text-4xl md:text-5xl font-bold tracking-wider text-white">
                    Economic Framework Quiz
                </h1>
                <p class="mt-4 text-lg text-gray-300">Test your knowledge of Articles IX, IX-A, and IX-B.</p>
            </header>

            <!-- Loading State -->
            <div id="loading-screen" class="card rounded-2xl p-8 text-center">
                <p class="text-lg text-gray-300">Loading questions...</p>
            </div>

            <!-- Quiz Setup -->
            <div id="setup-screen" class="card rounded-2xl p-8 text-center hidden">
                <h2 class="text-2xl font-bold text-white mb-4">Quiz Settings</h2>
                <div class="mb-6">
                    <label for="question-slider" class="block mb-2 text-lg text-gray-300">Number of Questions: <span id="slider-value" class="font-bold text-cyan-300">10</span></label>
                    <input id="question-slider" type="range" min="0" max="4" value="0" step="1" class="w-full">
                    <div class="w-full flex justify-between text-xs text-gray-400 px-1 mt-2">
                        <span>10</span><span>20</span><span>30</span><span>40</span><span>50</span>
                    </div>
                </div>
                <button id="start-btn" class="btn">Start Quiz</button>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <div id="progress-text" class="font-bold text-cyan-300"></div>
                    <a href="/invest.html" class="text-sm text-purple-300 hover:text-purple-200">&larr; Back to Framework</a>
                </div>
                <div class="card rounded-2xl p-8">
                    <h2 id="question-text" class="text-xl md:text-2xl font-semibold text-white mb-6"></h2>
                    <div id="options-container" class="space-y-4"></div>
                    <div id="explanation-container" class="mt-6 hidden">
                        <p class="font-bold text-lg text-white">Explanation:</p>
                        <p id="explanation-text" class="text-gray-300 mt-2"></p>
                    </div>
                </div>
                <div class="text-center mt-6">
                    <button id="next-btn" class="btn" disabled>Next Question</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden text-center">
                <div class="card rounded-2xl p-8">
                    <h2 class="font-orbitron text-3xl text-white mb-2">Quiz Complete!</h2>
                    <p class="text-2xl text-cyan-300 font-bold mb-4" id="score-text"></p>
                    <p class="text-xl text-purple-300 mb-6" id="grade-text"></p>
                    <button id="restart-btn" class="btn">Try Again</button>
                </div>
                <div id="results-summary" class="mt-8 text-left"></div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // DOM Elements
            const loadingScreen = document.getElementById('loading-screen');
            const setupScreen = document.getElementById('setup-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultsScreen = document.getElementById('results-screen');
            const startBtn = document.getElementById('start-btn');
            const nextBtn = document.getElementById('next-btn');
            const restartBtn = document.getElementById('restart-btn');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const progressText = document.getElementById('progress-text');
            const scoreText = document.getElementById('score-text');
            const gradeText = document.getElementById('grade-text');
            const explanationContainer = document.getElementById('explanation-container');
            const explanationText = document.getElementById('explanation-text');
            const resultsSummary = document.getElementById('results-summary');
            const slider = document.getElementById('question-slider');
            const sliderValue = document.getElementById('slider-value');

            const questionCounts = [10, 20, 30, 40, 50];
            let allQuestions = [];

            // State
            let selectedQuestions = [];
            let currentQuestionIndex = 0;
            let score = 0;
            let userAnswers = [];

            // --- Fetch Questions ---
            async function fetchQuestions() {
                try {
                    const response = await fetch('questions.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    allQuestions = data;
                    loadingScreen.classList.add('hidden');
                    setupScreen.classList.remove('hidden');
                } catch (error) {
                    loadingScreen.innerHTML = `<p class="text-red-400">Error loading questions. Please try refreshing the page.</p>`;
                    console.error("Failed to fetch questions:", error);
                }
            }

            // Slider Logic
            slider.addEventListener('input', () => {
                sliderValue.textContent = questionCounts[slider.value];
            });

            // Event Listeners
            startBtn.addEventListener('click', startQuiz);
            nextBtn.addEventListener('click', nextQuestion);
            restartBtn.addEventListener('click', restartQuiz);

            function startQuiz() {
                const numQuestions = questionCounts[slider.value];
                // Shuffle all questions and take the desired number
                selectedQuestions = [...allQuestions].sort(() => 0.5 - Math.random()).slice(0, numQuestions);
                
                currentQuestionIndex = 0;
                score = 0;
                userAnswers = [];

                setupScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                displayQuestion();
            }

            function displayQuestion() {
                explanationContainer.classList.add('hidden');
                nextBtn.disabled = true;

                if (currentQuestionIndex < selectedQuestions.length) {
                    const question = selectedQuestions[currentQuestionIndex];
                    progressText.textContent = `Question ${currentQuestionIndex + 1} of ${selectedQuestions.length}`;
                    questionText.textContent = question.question;
                    
                    optionsContainer.innerHTML = '';
                    // Shuffle options for each question
                    const shuffledOptions = [...question.options].sort(() => 0.5 - Math.random());
                    shuffledOptions.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option;
                        button.className = 'option-btn';
                        button.onclick = () => selectAnswer(option, button);
                        optionsContainer.appendChild(button);
                    });
                } else {
                    showResults();
                }
            }

            function selectAnswer(selectedOption, btn) {
                const question = selectedQuestions[currentQuestionIndex];
                const isCorrect = selectedOption === question.correctAnswer;

                if (isCorrect) {
                    score++;
                    btn.classList.add('correct');
                } else {
                    btn.classList.add('incorrect');
                }
                
                userAnswers.push({
                    question: question.question,
                    selected: selectedOption,
                    correct: question.correctAnswer,
                    explanation: question.explanation
                });
                
                Array.from(optionsContainer.children).forEach(button => {
                    button.disabled = true;
                    if (button.textContent === question.correctAnswer) {
                        button.classList.add('correct');
                    }
                });

                explanationText.textContent = question.explanation;
                explanationContainer.classList.remove('hidden');
                nextBtn.disabled = false;
            }

            function nextQuestion() {
                currentQuestionIndex++;
                displayQuestion();
            }

            function showResults() {
                quizScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');

                const percentage = Math.round((score / selectedQuestions.length) * 100);
                scoreText.textContent = `You scored ${score} out of ${selectedQuestions.length} (${percentage}%)`;

                let grade, gradeColor;
                if (percentage >= 90) { grade = "Grade: Cosmic Guardian"; gradeColor = "text-cyan-300"; }
                else if (percentage >= 75) { grade = "Grade: Planet Leader"; gradeColor = "text-green-400"; }
                else if (percentage >= 50) { grade = "Grade: Seed Investor"; gradeColor = "text-yellow-400"; }
                else { grade = "Grade: Curious Observer"; gradeColor = "text-orange-400"; }
                
                gradeText.textContent = grade;
                gradeText.className = `text-xl ${gradeColor} mb-6`;

                // Build summary
                resultsSummary.innerHTML = '<h3 class="font-orbitron text-2xl text-white my-6 text-center">Review Your Answers</h3>';
                userAnswers.forEach((answer, index) => {
                    const isCorrect = answer.selected === answer.correct;
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'card rounded-lg p-4 mb-4';
                    resultDiv.innerHTML = `
                        <p class="font-bold text-white">${index + 1}. ${answer.question}</p>
                        <p class="mt-2 ${isCorrect ? 'text-green-400' : 'text-red-400'}">Your answer: ${answer.selected} ${isCorrect ? '✔' : '✖'}</p>
                        ${!isCorrect ? `<p class="mt-1 text-green-400">Correct answer: ${answer.correct}</p>` : ''}
                        <p class="mt-2 text-sm text-gray-400"><strong class="text-purple-300">Explanation:</strong> ${answer.explanation}</p>
                    `;
                    resultsSummary.appendChild(resultDiv);
                });
            }

            function restartQuiz() {
                resultsScreen.classList.add('hidden');
                quizScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
            }

            // --- Initialize ---
            fetchQuestions();
        });
    </script>
</body>
</html>
